var c=(a,e,t)=>new Promise((n,d)=>{var s=r=>{try{l(t.next(r))}catch(o){d(o)}},i=r=>{try{l(t.throw(r))}catch(o){d(o)}},l=r=>r.done?n(r.value):Promise.resolve(r.value).then(s,i);l((t=t.apply(a,e)).next())});import{loadHeaderFooter as p,alertMessage as h}from"./utils.js";import g from"./ExternalServices.js";p("../partials/header.html","../partials/footer.html",!1);export default class u{constructor(e){this.mainElement=document.querySelector(e),this.token=null,this.services=new g}init(){}login(e,t){return c(this,null,function*(){try{const n=yield this.services.loginRequest(e);this.token=n.accessToken,t()}catch(n){h(n.message.message)}})}showLogin(){const e=document.createElement("div");e.setAttribute("class","login-container");const t=document.createElement("form");t.setAttribute("class","checkout-form"),t.setAttribute("id","login-form");const n=document.createElement("div");n.setAttribute("class","input-field");const d=document.createElement("label");d.innerHTML="Email";const s=document.createElement("input");s.type="email",s.name="email",s.id="email",s.placeholder="john@doe.com",s.required=!0,s.value="user1@email.com";const i=document.createElement("div");i.setAttribute("class","input-field");const l=document.createElement("label");l.innerHTML="Password";const r=document.createElement("input");r.type="password",r.name="password",r.id="password",r.placeholder="password",r.required=!0,r.value="user1";const o=document.createElement("button");o.setAttribute("class","btn-primary"),o.setAttribute("id","loginBtn"),o.type="submit",o.innerHTML="Login",n.appendChild(d),n.appendChild(s),i.appendChild(l),i.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(o),e.appendChild(t),this.mainElement.appendChild(e)}orderHtml(){return`<h2>Current Orders</h2>
    <table id="orders">
    <thead>
    <tr><th>Id</th><th>Date</th><th>#Items</th><th>Total</th>
    </thead>
    <tbody class="order-body"></tbody>
    </table>
    `}showOrders(){return c(this,null,function*(){try{const e=yield this.services.getOrders(this.token);this.mainElement.innerHTML=this.orderHtml();const t=document.querySelector("#orders tbody");t.innerHTML=e.map(n=>`<tr><td>${n.id}</td><td>${new Date(n.orderDate).toLocaleDateString("en-US")}</td><td>${n.items.length}</td><td>${n.orderTotal}</td></tr>`).join("")}catch(e){console.log(e)}})}}const m=new u("main");m.showLogin(),document.querySelector("#login-form").addEventListener("submit",a=>{a.preventDefault();const e={email:a.target.email.value,password:a.target.password.value};m.login(e,()=>{console.log("logged in"),m.showOrders()})},!1);
